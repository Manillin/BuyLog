<!-- templates/user_detail.html -->
{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Messaggi di successo -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Card Profilo -->
            <div class="card border-0 shadow-sm">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <img src="{{ user.profile.profile_image.url }}" 
                             alt="Immagine profilo" 
                             class="img-fluid rounded-circle mb-3 shadow-sm" 
                             style="width: 120px; height: 120px; object-fit: cover;">
                        <h4 class="mb-1">{{ user.first_name }} {{ user.last_name }}</h4>
                        <p class="text-muted">@{{ user.username }}</p>
                    </div>

                    <!-- Tabella informazioni -->
                    <div class="table-responsive mb-4">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <th scope="row" class="text-muted border-0">Nome</th>
                                    <td class="border-0">{{ user.first_name }}</td>
                                </tr>
                                <tr>
                                    <th scope="row" class="text-muted border-0">Cognome</th>
                                    <td class="border-0">{{ user.last_name }}</td>
                                </tr>
                                <tr>
                                    <th scope="row" class="text-muted border-0">Username</th>
                                    <td class="border-0">{{ user.username }}</td>
                                </tr>
                                <tr>
                                    <th scope="row" class="text-muted border-0">Email</th>
                                    <td class="border-0">{{ user.email }}</td>
                                </tr>
                                <tr>
                                    <th scope="row" class="text-muted border-0">Data registrazione</th>
                                    <td class="border-0">{{ user.date_joined|date:"d/m/Y" }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pulsanti allineati -->
                    <div class="text-center">
                        <button class="btn btn-primary rounded-pill px-4" 
                                data-toggle="modal" 
                                data-target="#editProfileModal">
                            <i class="fas fa-edit mr-2"></i>Modifica Dati
                        </button>
                        <form method="POST" action="{% url 'logout' %}" class="d-inline ml-2">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger rounded-pill px-4">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logoutt
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modale con tutti i campi originali -->
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">Modifica Profilo</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="small text-muted">Nome</label>
                        <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" required>
                    </div>
                    <div class="form-group">
                        <label class="small text-muted">Cognome</label>
                        <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" required>
                    </div>
                    <div class="form-group">
                        <label class="small text-muted">Username</label>
                        <input type="text" class="form-control" name="username" value="{{ user.username }}" required>
                    </div>
                    <div class="form-group">
                        <label class="small text-muted">Email</label>
                        <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
                    </div>
                    <div class="form-group mb-4">
                        <label class="small text-muted">Immagine Profilo</label>
                        <input type="file" class="form-control-file" name="profile_image">
                    </div>
                    <div class="text-right">
                        <button type="button" class="btn btn-light rounded-pill px-4 mr-2" data-dismiss="modal">Annulla</button>
                        <button type="submit" class="btn btn-primary rounded-pill px-4">Salva</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    setTimeout(function() {
        $('.alert').alert('close');
    }, 5000);
</script>
{% endblock %}