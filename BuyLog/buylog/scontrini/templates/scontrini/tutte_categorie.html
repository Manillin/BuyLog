{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center text-primary mb-4">Tutte le Categorie</h2>

    <!-- Filtri temporali -->
    <div class="text-center mb-4">
        <div class="btn-group" role="group" aria-label="Filtri temporali">
            <button type="button" class="btn btn-outline-primary filtro-btn {% if filtro_attuale == '1mese' %}active{% endif %}" data-filtro="1mese">1 Mese</button>
            <button type="button" class="btn btn-outline-primary filtro-btn {% if filtro_attuale == '6mesi' %}active{% endif %}" data-filtro="6mesi">6 Mesi</button>
            <button type="button" class="btn btn-outline-primary filtro-btn {% if filtro_attuale == '1anno' %}active{% endif %}" data-filtro="1anno">1 Anno</button>
            <button type="button" class="btn btn-outline-primary filtro-btn {% if filtro_attuale == 'all_time' %}active{% endif %}" data-filtro="all_time">All Time</button>
        </div>
    </div>

    <!-- Tabella Categorie -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th><a href="#" class="text-primary ordine-link" data-ordine="nome">Categoria</a></th>
                    <th><a href="#" class="text-primary ordine-link" data-ordine="-numero_prodotti">N° Prodotti</a></th>
                    <th><a href="#" class="text-primary ordine-link" data-ordine="-quantita_totale">Quantità Totale</a></th>
                    <th><a href="#" class="text-primary ordine-link" data-ordine="-totale_speso">Totale Speso</a></th>
                    <th><a href="#" class="text-primary ordine-link" data-ordine="-prezzo_medio">Prezzo Medio</a></th>
                </tr>
            </thead>
            <tbody>
                {% for categoria in categorie %}
                <tr>
                    <td>
                        <a href="{% url 'scontrini:dettagli_categoria' pk=categoria.prodotto__categoria__id %}" class="text-primary">
                            {{ categoria.prodotto__categoria__nome }}
                        </a>
                    </td>
                    <td>{{ categoria.numero_prodotti }}</td>
                    <td>{{ categoria.quantita_totale }}</td>
                    <td>{{ categoria.totale_speso|floatformat:2 }} €</td>
                    <td>{{ categoria.prezzo_medio|floatformat:2 }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginazione -->
    <div class="d-flex justify-content-center mt-4">
        {% if categorie.paginator.num_pages > 0 %}
        <nav aria-label="Navigazione pagine">
            <ul class="pagination">
                {% if categorie.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1&filtro={{ filtro_attuale }}&ordine={{ ordine_attuale }}">&laquo; Prima</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ categorie.previous_page_number }}&filtro={{ filtro_attuale }}&ordine={{ ordine_attuale }}">Precedente</a>
                    </li>
                {% endif %}

                <li class="page-item active">
                    <span class="page-link">{{ categorie.number }} di {{ categorie.paginator.num_pages }}</span>
                </li>

                {% if categorie.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ categorie.next_page_number }}&filtro={{ filtro_attuale }}&ordine={{ ordine_attuale }}">Successiva</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ categorie.paginator.num_pages }}&filtro={{ filtro_attuale }}&ordine={{ ordine_attuale }}">Ultima &raquo;</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'scontrini/js/tutte_categorie.js' %}"></script>
{% endblock %}